@model List<AppApi.ViewModels.SanPham.SanPhamView>

<h2 class="mb-4">Danh sách sản phẩm</h2>
@{
    var baseUrl = "https://localhost:7221/"; // 👈 đổi thành URL API của bạn
}
<div class="row">
    @foreach (var sp in Model)
    {
        var anh = sp.DanhSachAnh?.FirstOrDefault(a => a.AnhChinh == true)?.DuongDanAnh;
        var chiTiet = sp.ChiTiets?.FirstOrDefault();
        var giaGoc = chiTiet?.GiaBan ?? 0;
        var giaSauGiam = chiTiet?.GiaSauGiam ?? giaGoc;

        <div class="col-md-3 mb-4">
            <div class="card h-100 shadow-sm border-0">

                <!-- Ảnh sản phẩm căn giữa -->
                <div class="d-flex align-items-center justify-content-center"
                     style="height:230px; background:#f8f9fa;">
                    <img src="@($"{baseUrl}{anh}")"
                         alt="@sp.TenSanPham"
                         style="max-height:100%; max-width:100%; object-fit:contain;" />
                </div>

                <!-- Nội dung -->
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-truncate" title="@sp.TenSanPham">@sp.TenSanPham</h5>
                    <p class="text-muted mb-2">@sp.TenDanhMuc</p>

                    @if (giaSauGiam < giaGoc)
                    {
                        <p class="mb-2">
                            <span class="text-muted text-decoration-line-through">
                                @giaGoc.ToString("N0") đ
                            </span>
                            <span class="text-danger fw-bold ms-2">
                                @giaSauGiam.ToString("N0") đ
                            </span>
                        </p>
                    }
                    else
                    {
                        <p class="fw-bold mb-2">@giaGoc.ToString("N0") đ</p>
                    }

                    <div class="mt-auto">
                        <a asp-action="Details" asp-route-id="@sp.IDSanPham"
                           class="btn btn-primary btn-sm w-100">Xem chi tiết</a>
                    </div>
                </div>

            </div>
        </div>
    }
</div>
