<!DOCTYPE html>
<html lang="vi">
@{
    var token = Context.Session.GetString("Token");
    var email = Context.Session.GetString("Email") ?? "Khách";
    var roles = Context.Session.GetString("Roles") ?? "";
    var isAdmin = roles.Contains("Admin");
    var isLoggedIn = !string.IsNullOrEmpty(token);
}
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NEM - Giáng Sơn</title>

    <!-- CSS chính -->
    <link rel="stylesheet" href="~/css/styles.css" asp-append-version="true" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Font Google -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>
    <div class="topbar">
        <span>🏠 Hệ thống showroom</span>
        <span class="hotline">📞 Mua hàng online: 0246.2909098</span>
    </div>

    <header class="navbar">
        <div class="logo">
            <a href="#">
                <img src="~/img/image.png" alt="NEM Logo" asp-append-version="true" />
            </a>
        </div>

        <nav id="main-nav">
            <ul class="menu">
                <li>
                    <a href="#">Sản phẩm</a>
                    <ul class="dropdown">
                        <li><a href="#">Đầm</a></li>
                        <li><a href="#">Áo dài</a></li>
                        <li><a href="#">Áo sơ mi</a></li>
                    </ul>
                </li>
                <li><a href="#">Sản phẩm mới</a></li>
                <li><a href="#">Sản phẩm sale</a></li>
                <li><a href="#">Sản phẩm giá tốt</a></li>
                <li>
                    <a href="#">Bộ sưu tập</a>
                    <ul class="dropdown">
                        <li><a href="#">Xuân Hè</a></li>
                        <li><a href="#">Thu Đông</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <div class="account-cart">
            <div class="dropdown-btn">
                <span>👤 Tài khoản</span>
                <ul class="dropdown account-dropdown">
                    <li><a href="#">Đăng nhập</a></li>
                    <li><a href="#">Đăng ký</a></li>
                    <li><a href="#">Đơn hàng</a></li>
                </ul>
            </div>
            <div class="nav-right" id="userHeader">
                @if (isLoggedIn)
                {
                    <!-- User logged in -->
                    <a href="#" class="position-relative text-dark">🛒 Giỏ hàng</a>
                    <div class="dropdown">
                        <a href="#" class="text-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            👤 @email
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Thông tin cá nhân</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-shopping-bag me-2"></i>Đơn hàng của tôi</a></li>
                            @if (isAdmin)
                            {
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cogs me-2"></i>Quản trị</a></li>
                            }
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form asp-area="Auth" asp-controller="Auth" asp-action="Logout" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="dropdown-item text-danger">
                                        <i class="fas fa-sign-out-alt me-2"></i>Đăng xuất
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                }
                else
                {
                    <!-- User not logged in -->
                    <div class="d-flex align-items-center gap-3">
                        <a href="#" class="position-relative text-dark">🛒 Giỏ hàng</a>
                        <a href="#" class="text-dark" onclick="showLoginModal(); return false;">
                            <i class="fas fa-sign-in-alt me-1"></i>Đăng nhập
                        </a>
                        <a href="#" class="text-dark" onclick="showRegisterModal(); return false;">
                            <i class="fas fa-user-plus me-1"></i>Đăng ký
                        </a>
                    </div>
                }
            </div>
            <div class="dropdown-btn">
                <span>🛒 Giỏ hàng</span>
                <ul class="dropdown cart-dropdown">
                    
                    <li><a href="#">Thanh toán</a></li>
                </ul>
            </div>
        </div>
    </header>
    <li>
        <a href="@Url.Action("Index", "GioHangChiTiet")" class="btn btn-primary">
            🛒 Xem giỏ hàng
        </a>
    </li>
    <li>
        <a href="@Url.Action("Index", "HoaDon")" class="btn btn-primary">
            🛒 Xem Đơn Hàng
        </a>
    </li>
    <div class="breadcrumb">TRANG CHỦ / ÁO DÀI</div>

    <section class="banner">
        <img src="~/img/anhbaner1.png" alt="Giáng Sơn Áo Dài" class="banner-img" asp-append-version="true" />
    </section>

    <div class="container">
        <aside class="sidebar">
            <!-- Danh mục sản phẩm -->
            <h3>Danh mục</h3>
            <ul>
                <li><strong>Tất cả sản phẩm</strong></li>
                <li>
                    <strong>Đầm</strong>
                    <ul>
                        <li>Đầm suông</li>
                        <li>Đầm dáng A</li>
                        <li>Đầm ôm</li>
                        <li>Đầm maxi</li>
                    </ul>
                </li>
                <li>
                    <strong>Áo</strong>
                    <ul>
                        <li>Ngắn tay</li>
                        <li>Tay lỡ</li>
                        <li>Dài tay</li>
                    </ul>
                </li>
                <li>
                    <strong>Quần</strong>
                    <ul>
                        <li>Quần short</li>
                        <li>Quần lửng</li>
                        <li>Quần dài</li>
                        <li>Quần jeans</li>
                    </ul>
                </li>
                <li>
                    <strong>Chân váy</strong>
                    <ul>
                        <li>Chân váy xếp li</li>
                        <li>Chân váy bút chì</li>
                        <li>Chân váy chữ A</li>
                    </ul>
                </li>
                <li><strong>Set bộ</strong></li>
                <li><strong>Jumpsuit</strong></li>
                <li><strong>Áo dài</strong></li>
                <li>
                    <strong>Áo khoác</strong>
                    <ul>
                        <li>Măng tô</li>
                        <li>Áo vest</li>
                        <li>Áo phao</li>
                    </ul>
                </li>
            </ul>
        </aside>

        <main class="product-section">
            @RenderBody()
        </main>
    </div>

    <!-- Đăng ký nhận bản tin -->
    <section class="newsletter">
        <h2>ĐĂNG KÝ BẢN TIN</h2>
        <p>Đăng ký nhận bản tin NEM để được cập nhật những mẫu thiết kế mới nhất</p>
        <form class="subscribe-form">
            <input type="email" placeholder="Vui lòng nhập email..." />
            <button type="submit">ĐĂNG KÝ</button>
        </form>
        <div class="social-fixed">
            <a href="https://facebook.com" target="_blank" rel="noopener" class="social-icon fb" title="Facebook"></a>
            <a href="https://instagram.com" target="_blank" rel="noopener" class="social-icon ig" title="Instagram"></a>
            <a href="https://zalo.me" target="_blank" rel="noopener" class="social-icon zalo" title="Zalo"></a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-left">
                <h4>NEM FASHION - THỜI TRANG CÔNG SỞ</h4>
                <p>Công ty TNHH Dịch vụ và Thương mại An Thành.</p>
                <p>Số ĐKKD 0107861393, Sở KHĐT Tp. Hà Nội cấp ngày 04/10/2017</p>
                <p>
                    Địa chỉ: Lô 1+2, Ô quy hoạch E.2/NO7 đường Lâm Hạ,<br />
                    phường Bồ Đề, quận Long Biên, Hà Nội
                </p>
                <p>Chăm sóc khách hàng: <strong>0246.2591551</strong></p>
                <p>Mua hàng online: <strong>0246.2909098</strong></p>
                <p>Email: <a href="mailto:nemcskh@stripe-vn.com">nemcskh@stripe-vn.com</a></p>
            </div>

            <div class="footer-middle">
                <ul>
                    <li><a href="#">Giới thiệu</a></li>
                    <li><a href="#">Triết lý kinh doanh</a></li>
                    <li><a href="#">NEM’s Blog</a></li>
                    <li><a href="#">Hệ thống showroom</a></li>
                </ul>
                <ul>
                    <li><a href="#">Chính sách giao nhận</a></li>
                    <li><a href="#">Hướng dẫn thanh toán</a></li>
                    <li><a href="#">Tra cứu đơn hàng</a></li>
                    <li><a href="#">Hướng dẫn chọn Size</a></li>
                    <li><a href="#">Đổi trả - Bảo hành</a></li>
                </ul>
            </div>

            <div class="footer-right">
                <h5>Phương thức thanh toán</h5>
                <img src="~/img/payment-methods.png" alt="Phương thức thanh toán" asp-append-version="true" />
                <img src="~/img/verified-icon.png" alt="Đã thông báo Bộ Công Thương" style="margin-top: 10px;" asp-append-version="true" />
            </div>
        </div>
    </footer>
    <div class="alert alert-warning alert-dismissible fade show d-none position-fixed"
         id="emailConfirmationAlert"
         style="top: 20px; right: 20px; z-index: 9999;"
         role="alert">
        <strong>Vui lòng xác nhận email!</strong>
        <span id="emailConfirmationMessage"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    @Html.Partial("_LoginPartial", new AppView.Areas.Auth.ViewModel.LoginViewModel())
    @Html.Partial("_RegisterPartial", new AppView.Areas.Auth.ViewModel.RegisterViewModel())

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JS -->
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
        // Email confirmation alert function
        function showEmailConfirmationAlert(email) {
            const alertDiv = document.getElementById('emailConfirmationAlert');
            const messageSpan = document.getElementById('emailConfirmationMessage');

            if (alertDiv && messageSpan) {
                messageSpan.innerHTML = `Kiểm tra hộp thư đến của bạn hoặc
                    <a href="#" onclick="resendConfirmationEmail('${email}')">gửi lại email xác nhận</a>.`;
                alertDiv.classList.remove('d-none');
            }
        }

        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggleIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
    </script>
    @RenderSection("Scripts", required: false)
</body>
</html>
