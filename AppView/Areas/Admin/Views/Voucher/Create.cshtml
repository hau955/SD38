@model AppView.Areas.Admin.ViewModels.VoucherVM
@{
    ViewData["Title"] = "Thêm Voucher";
}

<h2>Thêm Voucher</h2>

<form asp-area="Admin" asp-controller="Voucher" asp-action="Create" method="post" id="voucherForm">
    <div class="form-group">
        <label>Mã code <span class="text-danger">*</span></label>
        <input asp-for="CodeVoucher" class="form-control" required />
        <span asp-validation-for="CodeVoucher" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Mô tả</label>
        <input asp-for="MoTa" class="form-control" />
    </div>

    <div class="form-group">
        <label>Phần trăm giảm (%) <span class="text-danger">*</span></label>
        <input asp-for="PhanTram" type="number" min="1" max="100" class="form-control" required />
        <span asp-validation-for="PhanTram" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Số tiền giảm tối đa (VNĐ)</label>
        <input asp-for="SoTienGiam" type="number" min="0" class="form-control" />
        <span asp-validation-for="SoTienGiam" class="text-danger"></span>
        <small class="form-text text-muted">Có thể để trống. Nếu nhập thì sẽ là mức giảm tối đa.</small>
    </div>

    <div class="form-group">
        <label>Điều kiện tối thiểu (VNĐ)</label>
        <input asp-for="DieuKienToiThieu" type="number" min="0" class="form-control" />
        <span asp-validation-for="DieuKienToiThieu" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Số lượng <span class="text-danger">*</span></label>
        <input asp-for="SoLuong" type="number" min="1" class="form-control" required />
        <span asp-validation-for="SoLuong" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Ngày bắt đầu <span class="text-danger">*</span></label>
        <input asp-for="StartDate" type="date" class="form-control" required />
        <span asp-validation-for="StartDate" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Ngày kết thúc <span class="text-danger">*</span></label>
        <input asp-for="EndDate" type="date" class="form-control" required />
        <span asp-validation-for="EndDate" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-primary">Lưu</button>
    <a asp-action="Index" class="btn btn-secondary">Quay lại</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $("#voucherForm").on("submit", function () {
            let phanTram = parseInt($("input[name='PhanTram']").val());
            let maxGiam = $("input[name='SoTienGiam']").val();
            let start = new Date($("input[name='StartDate']").val());
            let end = new Date($("input[name='EndDate']").val());
            let today = new Date();
            today.setHours(0, 0, 0, 0);

            if (!phanTram || phanTram <= 0 || phanTram > 100) {
                alert("Phần trăm giảm phải từ 1 đến 100.");
                return false;
            }

            if (maxGiam && maxGiam < 0) {
                alert("Số tiền giảm tối đa phải lớn hơn hoặc bằng 0.");
                return false;
            }

            if (start < today) {
                alert("Ngày bắt đầu không được nhỏ hơn ngày hiện tại.");
                return false;
            }

            if (end < start) {
                alert("Ngày kết thúc phải lớn hơn hoặc bằng ngày bắt đầu.");
                return false;
            }
        });
    </script>
}
