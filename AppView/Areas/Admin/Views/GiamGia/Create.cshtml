@model AppView.Areas.Admin.ViewModels.GiamGiaCreateVM

@{
    ViewData["Title"] = "Tạo giảm giá";
}

<h2>Tạo giảm giá</h2>

<form asp-area="Admin" asp-controller="GiamGia" asp-action="Create" method="post">
    <div asp-validation-summary="All" class="text-danger"></div>

    <!-- Tên giảm giá -->
    <div class="form-group">
        <label asp-for="GiamGia.TenGiamGia"></label>
        <input asp-for="GiamGia.TenGiamGia" class="form-control" />
        <span asp-validation-for="GiamGia.TenGiamGia" class="text-danger"></span>
    </div>

    <!-- Ngày bắt đầu -->
    <div class="form-group">
        <label asp-for="GiamGia.NgayBatDau"></label>
        <input asp-for="GiamGia.NgayBatDau" type="date" class="form-control" />
        <span asp-validation-for="GiamGia.NgayBatDau" class="text-danger"></span>
    </div>

    <!-- Ngày kết thúc -->
    <div class="form-group">
        <label asp-for="GiamGia.NgayKetThuc"></label>
        <input asp-for="GiamGia.NgayKetThuc" type="date" class="form-control" />
        <span asp-validation-for="GiamGia.NgayKetThuc" class="text-danger"></span>
    </div>

    <!-- Giá trị giảm -->
    <div class="form-group">
        <label asp-for="GiamGia.GiaTri"></label>
        <input asp-for="GiamGia.GiaTri" class="form-control" />
        <span asp-validation-for="GiamGia.GiaTri" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="GiamGia.GiaTriGiamToiDa"></label>
        <input asp-for="GiamGia.GiaTriGiamToiDa" class="form-control" />
        <span asp-validation-for="GiamGia.GiaTriGiamToiDa" class="text-danger"></span>
    </div>
    <!-- Danh mục -->
    <div class="form-group">
        <label>Chọn danh mục</label>
        <select id="DanhMucId" name="SelectedDanhMucs" class="form-control select2" multiple>
            @foreach (var dm in Model.DanhMucs)
            {
                <option value="@dm.DanhMucId">@dm.TenDanhMuc</option>
            }
        </select>
    </div>

    <!-- Sản phẩm -->
    <div class="form-group">
        <label>Chọn sản phẩm</label>
        <select id="SanPhamId" name="SelectedSanPhams" class="form-control select2" multiple>
            @foreach (var sp in Model.SanPhams)
            {
                <option value="@sp.IDSanPham">@sp.TenSanPham</option>
            }
        </select>
    </div>

    <input type="submit" value="Lưu Test" />
</form>

@section Scripts {
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('.select2').select2();

            const $giaTri = $("#GiaTriInput");
            const $loai = $("#LoaiGiamGia");

            // Validate loại giảm giá & giá trị
            $loai.change(function () {
                if ($(this).val() === "PhanTram") {
                    $giaTri.attr({ min: 1, max: 100, placeholder: "Nhập % (1 - 100)" });
                } else {
                    $giaTri.attr({ min: 1000, max: 500000, placeholder: "Nhập số tiền (1000 - 500000)" });
                }
            }).trigger("change");

            $giaTri.on("input", function () {
                let val = parseInt($(this).val() || 0);
                let min = parseInt($(this).attr("min"));
                let max = parseInt($(this).attr("max"));
                if (val < min) $(this).val(min);
                if (val > max) $(this).val(max);
            });
                  $(document).ready(function () {
            $('.select2').select2({
                allowClear: true,  // Cho phép bỏ chọn
                placeholder: "Chọn giá trị"
            });

            const $danhMuc = $("#DanhMucId");
            const $sanPham = $("#SanPhamId");

            function toggleSelects() {
                if ($danhMuc.val() && $danhMuc.val().length > 0) {
                    $sanPham.prop("disabled", true).val(null).trigger("change");
                } else if ($sanPham.val() && $sanPham.val().length > 0) {
                    $danhMuc.prop("disabled", true).val(null).trigger("change");
                } else {
                    $danhMuc.prop("disabled", false);
                    $sanPham.prop("disabled", false);
                }
            }

            $danhMuc.on("change", toggleSelects);
            $sanPham.on("change", toggleSelects);
        });
    </script>
}
